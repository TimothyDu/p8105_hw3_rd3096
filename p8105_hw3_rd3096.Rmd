---
title: "p8105_hw3_rd3096"
output: github_document
---

# load necessary pakages 
```{r setup}
library(tidyverse)
library(ggridges)
library(patchwork)
library(ggplot2)

library(p8105.datasets)
data("ny_noaa")

knitr::opts_chunk$set(
	echo = TRUE,
	warning = FALSE,
	fig.width = 8, 
  fig.height = 6,
  out.width = "90%"
)

theme_set(theme_minimal() + theme(legend.position = "bottom"))

options(
  ggplot2.continuous.colour = "viridis",
  ggplot2.continuous.fill = "viridis"
)

scale_colour_discrete = scale_colour_viridis_d
scale_fill_discrete = scale_fill_viridis_d
```

## problem 1

### read and explore the dataset "ny_noaa"

we explore the dataset and get a summary of the dataset

```{r}
str(ny_noaa)
summary(ny_noaa)
```

### we write a short description of the dataset and answer the following questions

Our dataset ahs `r nrow(ny_noaa)` rows and `r ncol(ny_noaa)` columns.It includes key variables such as id (station identifier), date, prcp (precipitation), snow (snowfall), snwd (snow depth), tmax (maximum temperature), and tmin (minimum temperature)."
The variable types based on our output are listed as follows:

* id: character

* date: Date format

* prcp, snow, snwd: integer

* tmax, tmin: character (we wil convert these into numeric later for proper analysis).

Missing data is a significant issue in the ny_noaa dataset, especially for snow depth (snwd) and snowfall (snow), Precipitation has less missing data, but it still affects a non-negligible portion of the dataset.

we will do some data cleaning for subquestion 1

```{r}
ny_noaa_cleaned = 
  ny_noaa %>%
  separate(date, into = c("year", "month", "day"), convert = TRUE) %>%
  mutate(
    tmax = as.numeric(tmax),    
    tmin = as.numeric(tmin)               
  )

ny_noaa_cleaned %>%
  group_by(snow) %>%
  summarize(count = n()) %>%
  arrange(desc(count))
```
After we cleaned our dataset, CONVERT the variables into numeric and count the number of observed values, we found out:

1. 0 mm of snowfall is the most frequently observed value, with 2,008,508 instances. This is because many days throughout the year do not experience snowfall, especially during non-winter months and in areas where snow is rare.

2. There are 381,221 missing values (NA) in the dataset for snowfall. These might correspond to missing data for days or locations where snowfall was not recorded.

3. Other common values include 25 mm, 13 mm, and 51 mm of snowfall, which likely represent light to moderate snowfall amounts. These values are typical during days when snow does occur, especially in regions that experience winter weather regularly.

we will make a two-panel plot for subquestion2
```{r}
  ny_noaa_cleaned %>% 
  filter(month %in% c(1, 7)) %>% 
  group_by(id, year, month) %>% 
  summarize(avg_tmax = mean(tmax, na.rm = TRUE), .groups = 'drop') %>% 
  ggplot(aes(x = year, y = avg_tmax, color = id)) +
  geom_point()+
  geom_line()+
  facet_grid(. ~ month)+
  labs(
      title = "Mean Monthly Temperature for Each Station Across Years (January and July)",
    x = "Year",
    y = "Mean Max Temperature (°C)",
    color = "Station"
  ) +
theme(legend.position = "none")
```
The mean temperature in January is significantly lower than the mean temperature in July across all stations and years. The stations show consistent patterns of temperature fluctuations over time, with peaks and valleys within each month. When one station exhibits a higher monthly mean temperature in a given year, most other stations tend to follow a similar pattern, indicating a general trend across regions. However, there is an observable anomaly between 1980 and 1990, where one station recorded an unusually cold temperature compared to others. 

we will make a two-panel plot for subquestion3
```{r}
tmax_tmin_p = 
  ny_noaa_cleaned %>%
  filter(!is.na(tmax), !is.na(tmin)) %>%  # Ensure there are no missing values
  ggplot(aes(x = tmin, y = tmax)) +
  geom_hex() +  # Use hexbin to show density of points
  scale_fill_viridis_c() +  # Use a continuous color scale
  labs(
    title = "tmax vs tmin",
    x = "Minimum Temperature (°C)",
    y = "Maximum Temperature (°C)",
    fill = "Density"
  ) +
  theme_minimal()


ny_noaa_ridge=
  ny_noaa_cleaned %>%
  filter(snow > 0 & snow < 100, !is.na(snow)) %>%  # Filter snowfall values
  ggplot(aes(x = snow, y = as.factor(year), fill = year)) +  # Treat year as a factor
  geom_density_ridges() +  # Create density ridges
  labs(
    title = "Snowfall Distribution by Year",
    x = "Snowfall (mm)",
    y = "Year"
  ) +
  theme_minimal()

tmax_tmin_p+ny_noaa_ridge
```
* The tmax vs tmin plot reveals a strong linear relationship between maximum and minimum temperatures, but also highlights several extreme outliers that need further investigation. These unrealistic values likely reflect data quality issues.

* The snowfall distribution plot shows that snowfall values are fairly consistent across the years, with some variability, especially in the late 2000s where higher snowfall amounts are observed. However, no extreme deviations are evident in the snowfall distributions, and the overall pattern remains relatively stable over time.


## problem 2

### read the dataset 
```{r}
demo= read.csv("./demo.csv", na=c("NA","","."), skip=4) 
acce = read.csv("./acce.csv",na=c("NA","","."))
```

### load, tidy and merge the datasets

we will clean the dataset,then we will merge the dataset by id.


